#!/usr/local/bin/perl
#translate routine to translate non-ascii characters into xml (mostly xhtml) entities

package XLogic::xpptran;

sub tranppdoc2xml {
	my($line)=@_;
	$_=$line;
# first process the &, < and > chars
	s/&/&amp;/g;
	s/</&lt;/g;
	s/>/&gt;/g;
	$line=&tranppdoc2xml_nft($_);
};

sub tranppdoc2xml_nft {
	my($line)=@_;
	$_=$line;
# first process the subscript/superscript characters
    s/\211(.)/<sub>$1<\/sub>/g;
    s/\233(.)/<sup>$1<\/sup>/g;
    s/\347([^\352]*)\352/<sup class="l">$1<\/sup>/g;
    s/\350([^\352]*)\352/<sub class="l">$1<\/sub>/g;
# then specific translations for each non-standard character
	s/\200/&sube;/g;
	s/\201/&#x2A65;/g;
	s/\202/&#x228E;/g;
	s/\203/&dsU;/g;
	s/\204/&Delta;/g;
	s/\205/&#205;/g;
	s/\206/&Phi;/g;
	s/\207/&Gamma;/g;
	s/\210/&#210;/g;
	s/\211/&#x22CE;/g;
	s/\212/&Theta;/g;
	s/\213/&#213;/g;
	s/\214/&Lambda;/g;
	s/\215/&isin;/g;
	s/\216/&notin;/g;
	s/\217/&Rarrtl;/g;
	s/\220/&Pi;/g;
	s/\221/&qqml;/g;
	s/\222/&#x25B7;/g;
	s/\223/&Sigma;/g;
	s/\224/&qqco;/g;
	s/\225/&upsilon;/g;
	s/\226/&dsB;/g;
	s/\227/&Omega;/g;
	s/\230/&Xi;/g;
	s/\231/&Psi;/g;
	s/\232/&empty;/g;
	s/\233/&#x22CF;/g;
	s/\234/&#x2550;/g;
	s/\235/&#235;/g;
	s/\236/&nnrarrtl;/g;
	s/\237/&nnrarr;/g;
	s/\240/&sub;/g;
	s/\241/&cap;/g;
	s/\242/&rang;/g;
	s/\243/&#x2296;/g;
	s/\244/&hArr;/g;
	s/\245/&lcap;/g;
	s/\246/&#246;/g;
	s/\247/&lang;/g;
	s/\250/&#x2987;/g;
	s/\251/&#x2988;/g;
	s/\252/&harr;/g;
	s/\253/&#x2295;/g;
	s/\254/&qqtel;/g;
	s/\255/&rarr;/g;
	s/\256/&qqter;/g;
	s/\257/&dsR;/g;
	s/\260/&#x220E;/g;
	s/\261/&and;/g;
	s/\262/&or;/g;
	s/\263/&not;/g;
	s/\264/&rArr;/g;
	s/\265/&forall;/g;
	s/\266/&exist;/g;
	s/\267/&bull;/g;
	s/\270/&cross;/g;
	s/\271/&#x24C8;/g;
	s/\272/&#272;/g;
	s/\273/&#x2A1F;/g;
	s/\274/&le;/g;
	s/\275/&ne;/g;
	s/\276/&ge;/g;
	s/\277/&dsS;/g;
	s/\300/&cup;/g;
	s/\301/&alpha;/g;
	s/\302/&beta;/g;
	s/\303/&#303;/g;
	s/\304/&delta;/g;
	s/\305/&epsilon;/g;
	s/\306/&phi;/g;
	s/\307/&gamma;/g;
	s/\310/&eta;/g;
	s/\311/&iota;/g;
	s/\312/&theta;/g;
	s/\313/&kappa;/g;
	s/\314/&lambda;/g;
	s/\315/&mu;/g;
	s/\316/&nu;/g;
	s/\317/&nurarr;/g;
	s/\320/&pi;/g;
	s/\321/&chi;/g;
	s/\322/&rho;/g;
	s/\323/&sigma;/g;
	s/\324/&tau;/g;
	s/\325/&#x03C5;/g;
	s/\326/&dsC;/g;
	s/\327/&omega;/g;
	s/\330/&xi;/g;
	s/\331/&psi;/g;
	s/\332/&zeta;/g;
	s/\333/&lib;/g;
	s/\334/&tvb;/g;
	s/\335/&rib;/g;
	s/\336/&lcup;/g;
	s/\337/&nrarr;/g;
	s/\340/&ratail;/g;
	s/\341/&#x2A64;/g;
	s/\342/&bottom;/g;
	s/\343/&lArr;/g;
	s/\344/&sup;/g;
	s/\345/&supe;/g;
	s/\346/&dsF;/g;
	s/\347/&#x2197;/g;
	s/\350/&#x2198;/g;
	s/\351/&equiv2;/g;
	s/\352/&#352;/g;
	s/\353/&#x2040;/g;
	s/\354/&#x21BF;/g;
	s/\355/&mapsto;/g;
	s/\356/&nat;/g;
	s/\357/&urarr;/g;
	s/\360/&weierp;/g;
	s/\361/&#361;/g;
	s/\362/&dr;/g;
	s/\363/&dsQ;/g;
	s/\364/&turnstil;/g;
	s/\365/&#365;/g;
	s/\366/&#366;/g;
	s/\367/&turnstil;/g;
	s/\366/&#366;/g;
	s/\371/&#x21BE;/g;
	s/\372/&dsZ;/g;
	s/\373/&#373;/g;
	s/\374/&#374;/g;
	s/\375/&#375;/g;
	s/\376/&nrarrtl;/g;
	s/\377/&qqtel;/g;
	$line=$_};

sub tranxml2ppdoc {
	my($line)=@_;
	$_=$line;
# first process the &, < and > chars
	s/&lt;/</g;
	s/&gt;/>/g;
	s/&amp;/&/g;
# add a manual entry for equiv

	$line=&tranxml2ppdoc_nft($_);
};

sub tranxml2ppdoc_nft {
	my($line)=@_;
	$_=$line;
# first process single subscripted characters
	s/<sub>(.)<\/sub>/\211$1/g;
	s/<sup class="l">([^<]*)<\/sup>/\347$1\352/g;
	s/<sub class="l">([^<]*)<\/sub>/\350$1\352/g;
# then process &#n; forms for <3 digits in n
	while(/\&\#(\d\d?\d?);/){my $pat="\\$1"; $pat=eval("\"$pat\""); s/\&\#$1;/$pat/};
# then the rest of the specific translations
	s/&sube;/\200/g;
	s/&#2A65;/\201/g;
	s/&#228E;/\202/g;
	s/&dsU;/\203/g;
	s/&Delta;/\204/g;
	s/&#!;/\205/g;
	s/&Phi;/\206/g;
	s/&Gamma;/\207/g;
	s/&#!;/\210/g;
	s/&#22CE;/\211/g;
	s/&Theta;/\212/g;
	s/&#!;/\213/g;
	s/&Lambda;/\214/g;
	s/&isin;/\215/g;
	s/&notin;/\216/g;
	s/&Rarrtl;/\217/g;
	s/&Pi;/\220/g;
	s/&qqml;/\221/g;
	s/&#25B7;/\222/g;
	s/&Sigma;/\223/g;
	s/&qqco;/\224/g;
	s/&upsilon;/\225/g;
	s/&dsB;/\226/g;
	s/&Omega;/\227/g;
	s/&Xi;/\230/g;
	s/&Psi;/\231/g;
	s/&empty;/\232/g;
	s/&#22CF;/\233/g;
	s/&#2550;/\234/g;
	s/&#!;/\235/g;
	s/&nnrarrtl;/\236/g;
	s/&nnrarr;/\237/g;
	s/&sub;/\240/g;
	s/&cap;/\241/g;
	s/&rang;/\242/g;
	s/&#2296;/\243/g;
	s/&hArr;/\244/g;
	s/&lcap;/\245/g;
	s/&#!;/\246/g;
	s/&lang;/\247/g;
	s/&#2987;/\250/g;
	s/&#2988;/\251/g;
	s/&harr;/\252/g;
	s/&#2295;/\253/g;
	s/&qqtel;/\254/g;
	s/&rarr;/\255/g;
	s/&qqter;/\256/g;
	s/&dsR;/\257/g;
	s/&#220E;/\260/g;
	s/&and;/\261/g;
	s/&or;/\262/g;
	s/&not;/\263/g;
	s/&rArr;/\264/g;
	s/&forall;/\265/g;
	s/&exist;/\266/g;
	s/&bull;/\267/g;
	s/&cross;/\270/g;
	s/&#24C8;/\271/g;
	s/&#!;/\272/g;
	s/&#2A1F;/\273/g;
	s/&le;/\274/g;
	s/&ne;/\275/g;
	s/&ge;/\276/g;
	s/&dsS;/\277/g;
	s/&cup;/\300/g;
	s/&alpha;/\301/g;
	s/&beta;/\302/g;
	s/&#!;/\303/g;
	s/&delta;/\304/g;
	s/&epsilon;/\305/g;
	s/&phi;/\306/g;
	s/&gamma;/\307/g;
	s/&eta;/\310/g;
	s/&iota;/\311/g;
	s/&theta;/\312/g;
	s/&kappa;/\313/g;
	s/&lambda;/\314/g;
	s/&mu;/\315/g;
	s/&nu;/\316/g;
	s/&nurarr;/\317/g;
	s/&pi;/\320/g;
	s/&chi;/\321/g;
	s/&rho;/\322/g;
	s/&sigma;/\323/g;
	s/&tau;/\324/g;
	s/&#03C5;/\325/g;
	s/&dsC;/\326/g;
	s/&omega;/\327/g;
	s/&xi;/\330/g;
	s/&psi;/\331/g;
	s/&zeta;/\332/g;
	s/&lib;/\333/g;
	s/&tvb;/\334/g;
	s/&rib;/\335/g;
	s/&lcup;/\336/g;
	s/&nrarr;/\337/g;
	s/&ratail;/\340/g;
	s/&#2A64;/\341/g;
	s/&bottom;/\342/g;
	s/&lArr;/\343/g;
	s/&sup;/\344/g;
	s/&supe;/\345/g;
	s/&dsF;/\346/g;
	s/&#2197;/\347/g;
	s/&#2198;/\350/g;
	s/&equiv2;/\351/g;
	s/&#!;/\352/g;
	s/&#2040;/\353/g;
	s/&#21BF;/\354/g;
	s/&mapsto;/\355/g;
	s/&nat;/\356/g;
	s/&urarr;/\357/g;
	s/&weierp;/\360/g;
	s/&#!;/\361/g;
	s/&dr;/\362/g;
	s/&dsQ;/\363/g;
	s/&turnstil;/\364/g;
	s/&#!;/\365/g;
	s/&#!;/\366/g;
	s/&turnstil;/\367/g;
	s/&#!;/\366/g;
	s/&#21BE;/\371/g;
	s/&dsZ;/\372/g;
	s/&#!;/\373/g;
	s/&#!;/\374/g;
	s/&#!;/\375/g;
	s/&nrarrtl;/\376/g;
	s/&qqtel;/\377/g;
	s/&equiv;/\244/g;
	$line=$_};

sub tranxxml2xml {
	my($line)=@_;
	$_=$line;
	s/\&qqml;/<sg name="qqml.gif"\/>/g;
	s/\&qqco;/<sg name="qqco.gif"\/>/g;
	s/\&lib;/&#x!;/g;
	s/\&rib;/&#x!;/g;
	$line=$_};

1;
